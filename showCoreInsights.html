<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>MyDiary</title>
		<link rel="stylesheet" type="text/css" href="css/bootstrap.css">
		<link rel="stylesheet" type="text/css" href="css/base.css">
		<link rel="stylesheet" type="text/css" href="css/chart.css">
		
		<script src="libs/jquery.min.js"></script>
		<script src="libs/bootstrap.js"></script>
		<script src="https://d3js.org/d3.v3.min.js"></script>
		<script src="js/chart.js"></script>
	</head>
	<body>
		<header>
			<div class="row">
				<div class="col-3 text-left" onclick="window.location='index.html'">
					<img src="images/full-logo-white.png" class="header-logo" alt="mydiary-logo">	
				</div>
				<div class="row col-6 menu-buttons">
					<div class="col-4 active">
						<a href="showCoreInsights.html">
							<p class="menu-button-text">Core Insights</p>
						</a>
					</div>
					<div class="col-4">
						<a href="showSimpleInsights.html">
							<p class="menu-button-text">Simple Language</p>
						</a>
					</div>
					<div class="col-4">
						<a href="showBasicInsights.html">
							<p class="menu-button-text">Basic Insights</p>
						</a>
					</div>
				</div>
				<div class="col-3 text-right">
					<img src="images/user-profile.jpg" class="user-profile-icon" alt="user-photo">
					<p class="user-profile-name">John Mathis</p>
					<img src="images/down-arrow.png" class="profile-more-icon" alt="down-arrow">
				</div>
			</div>
		</header>
		<div class="container charts-main-container"> 
			<div class="col-12 mt-8">
				<h5 class="data-title"><strong></strong></h5>
			</div>
			<div class="container col-12 single-chart-container mt-4">
				<div class="row text-left">
					<h5 class="col-3 text-left chart-title"><strong></strong></h5>
					<div class="col-9 text-right data-section-buttons">
					</div>
				</div>
				<div class="row col-12 text-left data-comparison-items">
				</div>
				<div class="row charts-box">
				</div>
				
			</div>
		</div>
		<script>
		
		var dataJson;
		var url = "https://api.myjson.com/bins/ek4kx";

		$(document).ready(function(){
			addInitialData();
		});

		function addInitialData(){
			$.getJSON( url, function( data ) {
			  if(data!=null){
			  	dataJson = data;
			  	$('.data-title').html("<strong>" + data.dataTitle + "</strong>");
			  	$('.chart-title').html("<strong>" + data.chartSections[0] + "</strong>");
			  	
			  	addDataComparisonItems(data.chartComparisonItems);

			  	addDataSectionButtons(data.chartSections);

			  	for(var i = 1; i <= data.charts.length; i++){
			  		var chartId = "chart"+i;
			  		console.log(chartId);
			  		var div = "<div class='col-6 lg-chart mt-4' id='" + chartId + "'></div>";
			  		$('.charts-box').append(div);
			  		drawChart("#"+chartId, data.charts[i-1][data.chartSections[0]], 0.6);
			  	}
			  }
			});
		}

		function addDataSectionButtons(chartSections){
			for(var i = 1; i <= chartSections.length; i++){
				var additionalClass = "";
				if(i == 1){
					additionalClass = "selected";
				}
				else{
					additionalClass = "unselected";	
				}

				var buttonId = "button"+(i-1);

				var button = "<button id=" + buttonId + " class='button data-section-button " + additionalClass +"' onclick='loadNewData(" + (i-1) + ")'>" + chartSections[i-1] + "</button>";
				$('.data-section-buttons').append(button);
			}
		}

		function addDataComparisonItems(chartComparisonItems){

			var colorsClass = ["blue", "red"];

			for(var i = 1; i <= chartComparisonItems.length; i++){
				var additionalClass = colorsClass[i-1];
				var div = "<div class='data-comparison-item text-left'><span class='data-comparison-item-title'>" + chartComparisonItems[i-1] + "</span><span class='data-comparison-item-icon " + additionalClass + "'></span></div>";

				$('.data-comparison-items').append(div);
			}
		}

		function loadNewData(chartSectionPosition){

			$('.data-section-button.selected').removeClass('selected').addClass('unselected');
			$('#button' + chartSectionPosition).removeClass('unselected').addClass('selected');

			$('.data-title').html("<strong>" + dataJson.dataTitle + "</strong>");
		  	$('.chart-title').html("<strong>" + dataJson.chartSections[chartSectionPosition] + "</strong>");
		  	$('.charts-box').empty();
		  	for(var i = 1; i <= dataJson.charts.length; i++){
		  		var chartId = "chart"+i;
		  		console.log(chartId);
		  		var div = "<div class='col-6 lg-chart mt-4' id='" + chartId + "'></div>";
		  		$('.charts-box').append(div);
		  		drawChart("#"+chartId, dataJson.charts[i-1][dataJson.chartSections[chartSectionPosition]], 0.6);
		  	}
		}

	</script>
	</body>
</html>